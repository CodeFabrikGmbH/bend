<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="/static/css/styles.css"/>
    <title></title>
    <script>
        function openPath(path) {
            window.location = "/config/" + path;
        }

        function deletePath(path) {
            let r = confirm("Delete all requests for path?");
            if (r === true) {
                let sendUrl = "/config/" + path;

                let xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState === XMLHttpRequest.DONE) {
                        window.location.reload();
                    }
                }
                xmlHttp.open("DELETE", sendUrl, true); // true for asynchronous
                xmlHttp.send(null);
            }
        }

        function save() {
            let path = document.getElementById("path").value;
            let statuscode = document.getElementById("statuscode").value;
            let target = document.getElementById("target").value;
            let body = document.getElementById("body").value;
            let data = JSON.stringify({ path: path, statuscode: statuscode, target: target, body: body });

            alert(data)

            let xmlHttp = new XMLHttpRequest();

            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState === XMLHttpRequest.DONE) {
                    // window.location.reload();
                }
            }

            let sendUrl = "/config/" + path;
            xmlHttp.open("PUT", sendUrl, true); // true for asynchronous
            xmlHttp.send(data);
        }

        function init() {
            let openReadme = document.getElementById("openReadme");
            openReadme.onclick = () => {
                window.open('/readme');
            };
        }

        window.onload = init;
    </script>
</head>

<body>
<div class="page-header">
    <p class="page-header-title">Bend</p>
    <button id="openReadme">?</button>
</div>

<div style="width: 100%">
    <table class="table-style">
        <tr>
            <th>Path</th>
            <th></th>
        </tr>
        {{ with .Configs }}
        {{ range . }}
        <tr>
            <td onclick="openPath({{.Path}})">{{.Path}}</td>
            <td onclick="deletePath({{.Path}})"><i class="gg-trash"></i></td>
        </tr>
        {{ end }}
        {{ end }}
    </table>

    <div class="table-style" style="width: 100%">
        <table class="request-details-style">
            {{ with .CurrentConfig }}
                <tr>
                    <td>Path</td>
                    <td>
                        <input style="width: 100%" type="text" id="path" value="{{.Path}}">
                    </td>
                </tr>
                <tr>
                    <td>Target</td>
                    <td>
                        <input style="width: 100%" type="text" id="target" value="{{.Target}}">
                    </td>
                </tr>

                <tr>
                    <td>StatusCode</td>
                    <td>
                        <input style="width: 100%" type="text" id="statuscode" value="{{.Response.StatusCode}}">
                    </td>
                </tr>

                <tr>
                    <td>Body</td>
                    <td>
                        <input style="width: 100%" type="text" id="body" value="{{.Response.Body}}">
                    </td>
                </tr>
            {{ end }}
        </table>
        <button class="button" style="width: 200px;" onclick="save()">Save</button>
    </div>
</div>


</body>